define(["jquery","geoloc/domReady","geoloc/mapContainer","underscore"],function($,domReady,MapContainer,_){var mapContainer,toggleMapClass="with-map",outsideMapSelector="."+toggleMapClass+" .panel-left, ."+toggleMapClass+" .panel-center",$mapClassHolder=$("body");var filtrerItemsSansCoordonnees=function(items){return _.reject(items,function(item){return item.coordonnees===undefined||(item.coordonnees.lat===undefined||item.coordonnees.lon===undefined)})};return{init:function(){$(document).on("click",
".btn-map",function(event){event.preventDefault();if(mapContainer.map==null){mapContainer.createMap();mapContainer.initMarkers()}$mapClassHolder.addClass(toggleMapClass)}).on("click",".panel-map .btn-nav",function(e){$mapClassHolder.removeClass(toggleMapClass)}).on("click",outsideMapSelector,function(e){if(!$(e.target).hasClass("btn-map")&&$mapClassHolder.hasClass(toggleMapClass))$mapClassHolder.removeClass(toggleMapClass)})},renderMap:function(idElement,items,nbreTotalResultat,defaults,smarttag){domReady(function(){if(idElement==
null&&(defaults!=null&&mapContainer==null))mapContainer=new MapContainer($("#map-offres"),filtrerItemsSansCoordonnees(items),nbreTotalResultat,defaults,smarttag);else if(idElement==null&&(defaults==null&&(items!=null&&mapContainer!=null))){mapContainer.items=filtrerItemsSansCoordonnees(items);mapContainer.nbreTotalResultat=nbreTotalResultat;if(mapContainer.map!=null)mapContainer.initMarkers()}})}}});